<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Mapping Fachoda</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet" />
<style>
	body {
        color: #404040;
        font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;
        margin: 0;
        padding: 0;
        -webkit-font-smoothing: antialiased;
      }

      * {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
      }

      .sidebar {
        position: absolute;
		font-family: Times New Roman;
        width: 20%;
        height: 100%;
        top: 0;
        left: 0;
        overflow: hidden;
        border-right: 1px solid rgba(0, 0, 0, 0.25);
      }

      .map {
        position: absolute;
        left: 20%;
        width: 80%;
        top: 0;
        bottom: 0;
      }

      h1 {
        font-size: 22px;
        margin: 0;
        font-weight: 400;
        line-height: 20px;
        padding: 20px 2px;
      }

      a {
        color: #404040;
        text-decoration: none;
      }

      a:hover {
        color: #101010;
      }

      .heading {
        background: #fff;
		
        border-bottom: 1px solid #eee;
        min-height: 60px;
        line-height: 60px;
        padding: 0 10px;
        background-color: #DACBB6;
        color: #000;
      }

		.sidebarcontent{
		padding-left:10px
		}

      .listings {
        height: 100%;
        overflow: auto;
        padding-bottom: 60px;
      }

      .listings .item {
        display: block;
        border-bottom: 1px solid #eee;
        
        text-decoration: none;
      }

      .listings .item:last-child {
        border-bottom: none;
      }
      .listings .item .title {
        display: block;
        color: #00853e;
        font-weight: 700;
      }

      .listings .item .title small {
        font-weight: 400;
      }
      .listings .item.active .title,
      .listings .item .title:hover {
        color: #8cc63f;
      }
      .listings .item.active {
        background-color: #DACBB6;
      }
      ::-webkit-scrollbar {
        width: 3px;
        height: 3px;
        border-left: 0;
        background: rgba(0, 0, 0, 0.1);
      }
      ::-webkit-scrollbar-track {
        background: none;
      }
      ::-webkit-scrollbar-thumb {
        background: #00853e;
        border-radius: 0;
      }
	  
	  li{
		list-style-type: none;
	  }
	  

	  
</style>
</head>
<body>
<div class="sidebar">
      <div class="heading">
        <h1>Mapping Fachoda</h1>
		
      </div>
	   <div class="sidebarcontent">
         <h4>Layers</h4>
		
  <li><input checked type="checkbox" id="oldfortress" name="oldfortress" value="oldfortress"  onchange="oldottoman(this)">
    <label for="oldfortress">Ottoman citadel</label>
  </li>
  <li><input type="checkbox" id="frenchfort" name="frenchfort" value="frenchfort" onchange="frenchfort(this)">
    <label for="frenchfort">French fort</label>
  </li>
  <li><input checked type="checkbox" id="pictures" name="pictures" value="pictures" onchange="pictures(this)">
    <label for="pictures">Pictures</label>
  </li>
		<h4>Background</h4>
		<div>
 
  <input type="radio" id="plan" name="background" value="plan" onclick="changeBasemap(this);" >
  <label for="plan">Plan</label><br>
	
  <input type="radio" id="img2004" name="background" value="google2004" checked onclick="changeBasemap(this);" >
  <label for="img2004">2004 satellite imagery </label><br>
  
  <input type="radio" id="img2019" name="background" value="google2019" onclick="changeBasemap(this);" >
  <label for="img2019">2019 satellite imagery</label><br>
 
  
</div>

	
		
</div>

    </div>
<div id="map" class="map"></div>
 
<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoibGVvLWlnYSIsImEiOiJjazY2bGV3MTYxMjV3M25sMmdtNWluM2wzIn0.2THSqD6nz9OhE0Xsjnbw1g';
var map = new mapboxgl.Map({
container: 'map',
zoom: 15.8,
center: [32.115,9.888],
pitch: 35,
bearing: -45,
style: {
"glyphs": "mapbox://fonts/mapbox/{fontstack}/{range}.pbf",
"light": {
  "anchor": "viewport",
  "color": "white",
  "intensity": 0.1
},
'version': 8,
'sources': {
'raster-tiles': {
'type': 'raster',
'tiles': [
'google2004/{z}/{x}/{y}.png'
],
'tileSize': 256
}
},
'layers': [
{
'id': 'simple-tiles',
'type': 'raster',
'source': 'raster-tiles',
'minzoom': 0,
'maxzoom': 22
}
]
},
});

function changeBasemap(radio) {
   
	// Set the tile url to a cache-busting url (to circumvent browser caching behaviour):
map.getSource('raster-tiles').tiles = [''+radio.value+'/{z}/{x}/{y}.png'],
map.setLayoutProperty('simple-tiles', 'visibility', 'none');
map.style._sourceCaches['other:raster-tiles'].clearTiles()
map.style._sourceCaches['other:raster-tiles'].update(map.transform)
map.setLayoutProperty('simple-tiles', 'visibility', 'visible');

// Force a repaint, so that the map will be repainted without you having to touch the map
map.triggerRepaint()
}

map.loadImage('marker.png', function(error, image) {
if (error) throw error;
if (!map.hasImage('marker')) map.addImage('marker', image);
});

map.loadImage('picture.png', function(error, image) {
if (error) throw error;
if (!map.hasImage('picture')) map.addImage('picture', image);
});

 
map.on('load', function () {
map.addSource('buildings', {
  type: 'geojson',
  data: 'fachoda.geojson'
});

map.addLayer({
'id': 'buildings',
'type': 'fill-extrusion',
'source': 'buildings',
'layout': {},
'paint': {
// See the Mapbox Style Specification for details on data expressions.
// https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions
 
// Get the fill-extrusion-color from the source 'color' property.
'fill-extrusion-color': '#fff',
 
// Get fill-extrusion-height from the source 'height' property.
'fill-extrusion-height': ['get', 'heigth'],
 
// Get fill-extrusion-base from the source 'base_height' property.
'fill-extrusion-base': 0,
 
// Make extrusions slightly opaque for see through indoor walls.
'fill-extrusion-opacity': 0.8,

}
});



map.addSource('french_fort', {
  type: 'geojson',
  data: 'french_fort.geojson'
});
map.addLayer({
'id': 'french_fort',
'type': 'fill-extrusion',
'source': 'french_fort',
'layout': {},
'paint': {
// See the Mapbox Style Specification for details on data expressions.
// https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions
 
// Get the fill-extrusion-color from the source 'color' property.
'fill-extrusion-color': 'blue',
 
// Get fill-extrusion-height from the source 'height' property.
'fill-extrusion-height': 4,
 
// Get fill-extrusion-base from the source 'base_height' property.
'fill-extrusion-base': 0,
 
// Make extrusions slightly opaque for see through indoor walls.
'fill-extrusion-opacity': 0.5,

}
});



map.setLayoutProperty('french_fort', 'visibility', 'none');

	map.addSource('labels', {
	  type: 'geojson',
	  data: 'labels.geojson'
	});
	map.addLayer({
	'id': 'labels',
	'type': 'symbol',
	'source': 'labels',
	'paint':{
	'text-halo-color':'#fff',
	'text-color':'#000',
	'text-halo-width':1
	},
	'layout': {
		'text-field': ['get', 'label'],
		'text-font': [
			'literal',
			['DIN Offc Pro Italic', 'Arial Unicode MS Regular']
			],
		'text-variable-anchor': ['bottom'],
		'text-radial-offset': 1,
		'text-justify': 'auto',
		'icon-image': 'marker',
		'icon-anchor': 'bottom'
		}
	});
	






// When a click event occurs on a feature in the places layer, open a popup at the
// location of the feature, with description HTML from its properties.
map.on('click', 'pictures', function (e) {
var coordinates = e.features[0].geometry.coordinates.slice();
var name = e.features[0].properties.name;
var picturepath = e.features[0].properties.picture;
var desc = e.features[0].properties.desc;
var source = e.features[0].properties.source;
 
// Ensure that if the map is zoomed out such that multiple
// copies of the feature are visible, the popup appears
// over the copy being pointed to.
while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
}
 
new mapboxgl.Popup()
.setLngLat(coordinates)
.setHTML('<p>Moudirich of Fachoda, 10th of July 1898</p><img src="imgs/moudirich.png" width="100%">')
.addTo(map);
});
 
// Change the cursor to a pointer when the mouse is over the places layer.
map.on('mouseenter', 'pictures', function () {
map.getCanvas().style.cursor = 'pointer';
});
 
// Change it back to a pointer when it leaves.
map.on('mouseleave', 'pictures', function () {
map.getCanvas().style.cursor = '';
});

map.addSource('french_labels', {
	  type: 'geojson',
	  data: 'french_labels.geojson'
	});
	map.addLayer({
	'id': 'french_labels',
	'type': 'symbol',
	'source': 'french_labels',
	'paint':{
	'text-halo-color':'#fff',
	'text-color':'#000',
	'text-halo-width':1
	},
	'layout': {
		'text-field': ['get', 'label'],
		'text-font': [
			'literal',
			['DIN Offc Pro Italic', 'Arial Unicode MS Regular']
			],
		'text-variable-anchor': ['bottom'],
		'text-radial-offset': 1,
		'text-justify': 'auto',
		'icon-image': 'marker',
		'icon-anchor': 'bottom'
		}
	});
map.setLayoutProperty('french_labels', 'visibility', 'none');


map.addSource('pictures', {
	  type: 'geojson',
	  data: 'pictures.geojson'
	});
	map.addLayer({
	'id': 'pictures',
	'type': 'symbol',
	'source': 'pictures',
	'paint':{
	'text-halo-color':'#fff',
	'text-color':'#000',
	'text-halo-width':1
	},
	'layout': {
		
		'icon-image': 'picture',
		
		}
	});

 
// add a sky layer that will show when the map is highly pitched
map.addLayer({
'id': 'sky',
'type': 'sky',
'paint': {
'sky-type': 'atmosphere',
'sky-atmosphere-sun': [0.0, 0.0],
'sky-atmosphere-sun-intensity': 15
}
});

// Force a repaint, so that the map will be repainted without you having to touch the map
map.flyTo({
// These options control the ending camera position: centered at
// the target, at zoom level 9, and north up.
center: [32.115,9.888],
zoom: 16,
bearing: -45,
pitch: 45,
// These options control the flight curve, making it move
// slowly and zoom out almost completely before starting
// to pan.
speed: 0.2, // make the flying slow
curve: 1, // change the speed at which it zooms out
 
// This can be any easing function: it takes a number between
// 0 and 1 and returns another number between 0 and 1.
easing: function (t) {
return t;
},
 
// this animation is considered essential with respect to prefers-reduced-motion
essential: true
});


});

//checkboxes
function oldottoman(checkboxElem) {
  if (checkboxElem.checked) {
    map.setLayoutProperty('buildings', 'visibility', 'visible');
	map.setLayoutProperty('labels', 'visibility', 'visible');
  } else {
   map.setLayoutProperty('buildings', 'visibility', 'none');
   map.setLayoutProperty('labels', 'visibility', 'none');
  }
}


function frenchfort(checkboxElem) {
  if (checkboxElem.checked) {
    map.setLayoutProperty('french_fort', 'visibility', 'visible');
	map.setLayoutProperty('french_labels', 'visibility', 'visible');
  } else {
   map.setLayoutProperty('french_fort', 'visibility', 'none');
   map.setLayoutProperty('french_labels', 'visibility', 'none');
  }
}

function pictures(checkboxElem) {
  if (checkboxElem.checked) {
    map.setLayoutProperty('pictures', 'visibility', 'visible');
  } else {
   map.setLayoutProperty('pictures', 'visibility', 'none');
  }
}




</script>
 
</body>
</html>